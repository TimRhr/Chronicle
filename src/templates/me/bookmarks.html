{% extends "base.html" %}
{% from "components/post_card.html" import post_card_full with context %}
{% from "components/reactions_js.html" import reactions_scripts %}
{% from "components/poll.html" import poll_voting_js %}

{% block title %}{{ _('Bookmarks') }} - Chronicle{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex items-center justify-between mb-6">
        <h1 class="font-heading text-2xl font-bold">{{ _('Bookmarks') }}</h1>
        <button onclick="history.back()" class="text-sm text-light-text-muted dark:text-dark-text-muted hover:text-brand-teal transition-colors">
            ‚Üê {{ _('Back') }}
        </button>
    </div>
    
    {% if posts %}
    <div class="space-y-6">
        {% for post in posts %}
        {% set is_own_post = current_user.is_authenticated and current_user.id == post.author.id %}
        {{ post_card_full(post, post.author.theme_color, is_own_post) }}
        {% endfor %}
    </div>
    {% else %}
    <div class="glass-card p-12 text-center">
        <svg class="w-16 h-16 mx-auto mb-4 text-light-text-muted dark:text-dark-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/></svg>
        <h3 class="font-heading text-lg font-bold mb-2">{{ _('No bookmarks') }}</h3>
        <p class="text-light-text-muted dark:text-dark-text-muted">{{ _('Save interesting posts as bookmarks.') }}</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ poll_voting_js() }}
{{ reactions_scripts(current_user.theme_color, current_user.id if current_user.is_authenticated else None) }}
<script>
    if (typeof initBookmarkButton === 'function') {
        initBookmarkButton = function(article) {
            const postReactions = article.querySelector('.post-reactions');
            if (!postReactions) return;
            const bookmarkBtn = article.querySelector('.bookmark-btn');
            if (!bookmarkBtn || bookmarkBtn.dataset.initialized) return;
            bookmarkBtn.dataset.initialized = 'true';

            const postId = postReactions.dataset.postId;
            const icon = bookmarkBtn.querySelector('.bookmark-icon');
            if (icon) {
                icon.setAttribute('fill', '#f5c542');
                icon.setAttribute('stroke', '#f5c542');
            }

            bookmarkBtn.addEventListener('click', function() {
                fetch('/api/posts/' + postId + '/bookmark', { method: 'POST' })
                    .then(res => res.json())
                    .then(data => {
                        if (!data.bookmarked) {
                            article.remove();
                        }
                    });
            });
        }
    }

    // Delete post buttons with confirm modal
    const csrfToken = '{{ csrf_token() }}';
    document.querySelectorAll('.delete-post-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const postId = this.dataset.postId;
            if (window.confirmModal && window.confirmModal.show) {
                window.confirmModal.show({
                    title: window.I18N.delete_post,
                    message: window.I18N.delete_post_confirm,
                    confirmText: window.I18N.delete,
                    confirmClass: 'bg-red-600 hover:bg-red-700',
                    action: function() {
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = '/me/posts/' + postId + '/delete?next={{ request.full_path|urlencode }}';
                        const csrfInput = document.createElement('input');
                        csrfInput.type = 'hidden';
                        csrfInput.name = 'csrf_token';
                        csrfInput.value = csrfToken;
                        form.appendChild(csrfInput);
                        document.body.appendChild(form);
                        form.submit();
                    }
                });
            }
        });
    });
</script>
{% endblock %}

